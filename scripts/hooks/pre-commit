#!/usr/bin/env bash
# Pre-commit hook: ruff lint/format + frontend tsc on staged files.
# Install:  scripts/hooks/install.sh

set -e

REPO_ROOT="$(git rev-parse --show-toplevel)"

# ── Python lint (ruff) ─────────────────────────────────
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)
if [ -n "$PYTHON_FILES" ]; then
    echo "Running ruff on staged Python files..."
    ruff check $PYTHON_FILES
    ruff format --check $PYTHON_FILES
fi

# ── Frontend type-check (only if frontend files changed) ──
FRONTEND_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '^services/warden/frontend/' || true)
if [ -n "$FRONTEND_FILES" ]; then
    echo "Running tsc on frontend..."
    (cd "$REPO_ROOT/services/warden/frontend" && npx tsc --noEmit)
fi
