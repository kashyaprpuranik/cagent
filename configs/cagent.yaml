# =============================================================================
# Cagent Data Plane Configuration
# =============================================================================
# Single source of truth for:
#   - Domain allowlist (generates CoreDNS + Envoy configs)
#   - Credentials for secret injection
#   - Rate limits
#   - Aliases (*.devbox.local shortcuts)
#
# Changes to this file auto-regenerate CoreDNS and Envoy configs.
# =============================================================================

# Operation mode: 'standalone' or 'connected'
# - standalone: Use only this config file
# - connected: Sync from control plane, use this as fallback
mode: standalone

# Upstream DNS servers for resolving allowed domains
dns:
  upstream:
    - 8.8.8.8
    - 8.8.4.4
  cache_ttl: 300  # seconds

# Default rate limit for domains without specific limits
rate_limits:
  default:
    requests_per_minute: 120
    burst_size: 20

# Container security settings
security:
  seccomp_profile: standard  # standard (dev), hardened (prod). permissive exists but disables sandboxing — debug only

# Container resource limits (standalone mode)
# Warden writes these to .env → docker-compose reads them via ${VAR:-default}
# Omit or set to null to use docker-compose defaults
resources:
  cpu_limit: 2.0            # Number of CPUs (e.g., 0.5, 1.0, 2.0)
  memory_limit_mb: 2048     # Memory limit in MB
  pids_limit: 256           # Max number of processes

# =============================================================================
# Domain Allowlist
# =============================================================================
# Each domain entry can have:
#   - domain: required, the domain pattern (supports wildcards like *.github.com)
#   - alias: optional, creates {alias}.devbox.local shortcut
#   - credential: optional, injects auth header for this domain
#   - rate_limit: optional, per-domain rate limiting
#   - timeout: optional, request timeout (default: 30s)
#   - read_only: optional, block POST/PUT/DELETE methods
#   - tls: optional, use HTTPS upstream (default: true for port 443)
# =============================================================================

domains:
  # -------------------------------------------------------------------------
  # AI APIs
  # -------------------------------------------------------------------------
  - domain: api.openai.com
    alias: openai
    timeout: 120s
    rate_limit:
      requests_per_minute: 60
      burst_size: 10
    # credential:
    #   header: Authorization
    #   format: "Bearer {value}"
    #   env: OPENAI_API_KEY

  - domain: api.anthropic.com
    alias: anthropic
    timeout: 120s
    rate_limit:
      requests_per_minute: 60
      burst_size: 10
    # credential:
    #   header: x-api-key
    #   format: "{value}"
    #   env: ANTHROPIC_API_KEY

  # -------------------------------------------------------------------------
  # GitHub
  # -------------------------------------------------------------------------
  - domain: github.com
  - domain: api.github.com
    alias: github
    timeout: 30s
    # credential:
    #   header: Authorization
    #   format: "token {value}"
    #   env: GITHUB_TOKEN
  - domain: raw.githubusercontent.com
  - domain: objects.githubusercontent.com
  - domain: gist.githubusercontent.com
  - domain: codeload.github.com

  # -------------------------------------------------------------------------
  # Python Package Index (read-only)
  # -------------------------------------------------------------------------
  - domain: pypi.org
    read_only: true
  - domain: files.pythonhosted.org
    read_only: true

  # -------------------------------------------------------------------------
  # HuggingFace (large model downloads)
  # -------------------------------------------------------------------------
  - domain: huggingface.co
    alias: huggingface
    timeout: 300s
  - domain: cdn-lfs.huggingface.co
    timeout: 600s

  # -------------------------------------------------------------------------
  # npm Registry (read-only)
  # -------------------------------------------------------------------------
  - domain: registry.npmjs.org
    read_only: true
  - domain: registry.yarnpkg.com
    read_only: true

  # -------------------------------------------------------------------------
  # Additional LLM Providers
  # -------------------------------------------------------------------------
  - domain: openrouter.ai
    timeout: 120s
    rate_limit:
      requests_per_minute: 60
      burst_size: 10
    # credential:
    #   header: Authorization
    #   format: "Bearer {value}"
    #   env: OPENROUTER_API_KEY

  - domain: api.perplexity.ai
    timeout: 120s
    rate_limit:
      requests_per_minute: 30
      burst_size: 5
    # credential:
    #   header: Authorization
    #   format: "Bearer {value}"
    #   env: PERPLEXITY_API_KEY

  - domain: api.x.ai
    timeout: 120s
    rate_limit:
      requests_per_minute: 30
      burst_size: 5

  - domain: api.minimax.io
    timeout: 120s
    rate_limit:
      requests_per_minute: 30
      burst_size: 5

  - domain: chatgpt.com
    rate_limit:
      requests_per_minute: 10
      burst_size: 5

  - domain: claude.ai
    rate_limit:
      requests_per_minute: 10
      burst_size: 5

  # -------------------------------------------------------------------------
  # Messaging Channels
  # -------------------------------------------------------------------------
  - domain: api.telegram.org
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: discord.com
    rate_limit:
      requests_per_minute: 60
      burst_size: 15

  - domain: gateway.discord.gg

  - domain: cdn.discordapp.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: api.slack.com
    rate_limit:
      requests_per_minute: 60
      burst_size: 15

  - domain: wss-primary.whatsapp.net

  - domain: mmg.whatsapp.net
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: web.whatsapp.com

  - domain: chat.googleapis.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: graph.microsoft.com
    rate_limit:
      requests_per_minute: 60
      burst_size: 15

  - domain: api.botframework.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: open.feishu.cn
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: bot-api.zaloplatforms.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  # -------------------------------------------------------------------------
  # Tools & Media
  # -------------------------------------------------------------------------
  - domain: api.search.brave.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 5
    # credential:
    #   header: X-Subscription-Token
    #   format: "{value}"
    #   env: BRAVE_API_KEY

  - domain: api.firecrawl.dev
    rate_limit:
      requests_per_minute: 10
      burst_size: 3
    # credential:
    #   header: Authorization
    #   format: "Bearer {value}"
    #   env: FIRECRAWL_API_KEY

  - domain: api.elevenlabs.io
    rate_limit:
      requests_per_minute: 10
      burst_size: 3
    # credential:
    #   header: xi-api-key
    #   format: "{value}"
    #   env: ELEVENLABS_API_KEY

  - domain: api.deepgram.com
    rate_limit:
      requests_per_minute: 10
      burst_size: 3
    # credential:
    #   header: Authorization
    #   format: "Token {value}"
    #   env: DEEPGRAM_API_KEY

  - domain: www.youtube.com
    read_only: true
    rate_limit:
      requests_per_minute: 10
      burst_size: 3

  # -------------------------------------------------------------------------
  # OAuth & Auth
  # -------------------------------------------------------------------------
  - domain: oauth2.googleapis.com
    rate_limit:
      requests_per_minute: 10
      burst_size: 5

  - domain: www.googleapis.com
    rate_limit:
      requests_per_minute: 30
      burst_size: 10

  - domain: login.microsoftonline.com
    rate_limit:
      requests_per_minute: 10
      burst_size: 5

# =============================================================================
# Email Accounts (opt-in with --profile email)
# =============================================================================
# Each account configures IMAP/SMTP access with credential injection.
# Providers: gmail (OAuth2), outlook (OAuth2), generic (password).
# Agent accesses via http://email.devbox.local/...
#
# email:
#   accounts:
#     - name: work-gmail                    # Unique identifier
#       provider: gmail                     # gmail | outlook | generic
#       email: agent@company.com            # Account email address
#       imap_server: imap.gmail.com         # Auto-set by provider, overridable
#       smtp_server: smtp.gmail.com
#       credential:
#         client_id_env: GMAIL_CLIENT_ID        # OAuth2 client ID
#         client_secret_env: GMAIL_CLIENT_SECRET # OAuth2 client secret
#         refresh_token_env: GMAIL_REFRESH_TOKEN # OAuth2 refresh token
#       policy:
#         allowed_recipients:               # Who agent can email
#           - "*@company.com"               # Wildcards
#           - "partner@external.com"        # Exact match
#         allowed_senders:                  # Filter inbox to these senders
#           - "*"                           # Read from anyone
#         sends_per_hour: 50
#         reads_per_hour: 200
#
#     - name: notifications                 # Generic IMAP/SMTP
#       provider: generic
#       email: bot@myserver.com
#       imap_server: mail.myserver.com
#       imap_port: 993
#       smtp_server: mail.myserver.com
#       smtp_port: 587
#       credential:
#         password_env: MAIL_PASSWORD       # Plain password
#       policy:
#         allowed_recipients: ["admin@myserver.com"]
#         allowed_senders: ["*@myserver.com"]
#         sends_per_hour: 20
#         reads_per_hour: 100


# =============================================================================
# Internal Services (Docker DNS)
# =============================================================================
# These resolve via Docker's internal DNS (127.0.0.11)
internal_services:
  - backend
  - envoy
  - dns-filter
  - vector
